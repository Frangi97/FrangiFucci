\documentclass[12pt,a4paper]{report}

%Set language
\usepackage[english]{babel}
\usepackage{enumerate}

% To import and adjust images
\usepackage{graphicx}
\usepackage[export]{adjustbox}
\usepackage[center]{caption}
\usepackage{subcaption}
\usepackage{float}
\usepackage{tabularx}

% To build a clickable Toc
\usepackage{color} %May be necessary if you want to color links
\usepackage{hyperref}
\hypersetup{
    colorlinks=true, %set true if you want colored links
    linktoc=all,     %set to all if you want both sections and subsections linked
    linkcolor=black,  %choose some color if you want links to stand out
    urlcolor = black
}

%To load PoLitecnico's logo
\usepackage{titling}

% Command to hide subsections in the Toc
\setcounter{tocdepth}{1}

% I don't like dots in the Toc
\usepackage{tocloft}
\renewcommand{\cftdot}{}


% Path relative to the .tex file containing the \includegraphics command
\graphicspath{ {./images/} }

% To change the ToC title
\addto\captionsenglish{ \renewcommand {\contentsname} {Table of
contents}}

%logo
\pretitle{
	 \begin{center}
	 \LARGE
	 \includegraphics[width = 0.6\textwidth]{logo}\\[\bigskipamount]
}
\posttitle{\end{center}}

% Here we go
\title{SafeStreets - DD \\ \large version 1.0}
\author{Frangi Alberto, Fucci Tiziano}
\date{A.Y. 2019/2020}
\begin{document}
	\maketitle
	%Index
	\tableofcontents
	\chapter{Introduction}
		\section{Purpose}
			The purpose of this document consists of giving more technical details than the RASD concerning the SafeStreets
			system.\\
			The RASD document completely describes the system in terms of functional and nonfunctional requirements and
			serves as a contractual basis between the customer and the developer and it must be written in the language of
			the customer's domain of business/expertise, the DD's purpose instead is to provide a description for how the new
			system will be constructed, it provides a description of the system architecture, software, hardware, database
			design, and security.\\
			In particular this document will explain the following topics:
			\begin{itemize}
				\item High level architecture and its components' requirements;
				\item Run-time behavior;
				\item Design patterns;
				\item Additional user interfaces information;
				\item Implementation, integration and testing plan.
			\end{itemize}
		\section{Scope}
			Safestreet is an application to be used both from civilians (users) and authorities, in order to help the latter and
			reduce traffic violations. Registered authorities can automatically receive reports made by users, so the service acts
			as an intermediary. The next paragraph gives a more formal description of system's architecture.

		\section{Definitions, Acronyms, Abbreviations}
			\subsection{Definitions}
				\begin{itemize}
				\item \textbf{User}: a civilian customer that can use the application to:
					\begin{itemize}
					\item notify authorities of some violation;
					\item check which are the most dangerous (i.e. with the most violations) streets.
					\end{itemize}
				In this document, ``user", ``citizen" and ``civiian" are completely equivalent, where not specified.
				\item \textbf{Authority}: a member of the local police who has access to reports made by users. The
					authorities evaluate the reports sent by the user to determine if the violation stands.
				\item \textbf{Report}: a message consisting of:
					\begin{itemize}
					\item a picture showing the car in order to show the occurring violation;
					\item date and time of the picture;
					\item GPS position of the place where the violation occurred;
					\item the street where the violation occurred (automatically retrieved from the geographical position);
					\item the type of the violation (input by the user)
					\end{itemize}
				\item \textbf{Available}: a report is available for an authority if its position is within the municipality assigned
					to the authority.
				\item \textbf{Violation}: a situation that, according to the user who sent the report, is a violation of the
					traffic laws.
				\item \textbf{Intervention}: a brief text suggesting a possible solution in order to improve safety and
					discourage future violations.
				\end{itemize}
			\subsection{Acronyms}
				\begin{itemize}
				\item \textbf{API}: \emph{Application Programming Interface.}
				\item \textbf{GPS}: \emph{Global Positioning System.}
				\item \textbf{UI}: \emph{User Interface.}
				\item \textbf{RASD:} \emph{Requirements Analysis and Specifications Document}
				\item \textbf{DD:} \emph{Design Document}
				\item \textbf{DMZ:} \emph{DeMilitarized Zone}
				\item \textbf{PKC}: \emph{Public Key Cryptography.}
				\item \textbf{AES}: \emph{Advanced Encryption Standard.}
				\item \textbf{OCR}: \emph{Optical Character Recognition.}
				\item \textbf{DB}: \emph{Data base}
				\end{itemize}
		\section{Revision History}
			\begin{itemize}
				\item \textbf{Version 1.0:}
				\begin{itemize}
					\item First release.
				\end{itemize}
			\end {itemize}
		\section{Reference Documents}
			\begin{itemize}
				\item \textbf{Specification document:} "Mandatory project assignment AY 2019/20".
			\end{itemize}
		\section{Document Structure}
			\begin{itemize}
				\item \textbf{Chapter 1} provides a brief explanation on the DD purpose and a quick introduction
					SafeStreets.
				\item \textbf{Chapter 2} aims to provide a description of the system's architecture.
				\item \textbf{Chapter 3} specifies the design of user interfaces and describes the user-application
					interaction.
				\item \textbf{Chapter 4} contains requirements traceability.
				\item \textbf{Chapter 5} describes the implementation plan.
				\item \textbf{Chapter 6} shows the effort of each group member.
				\item \textbf{Chapter 7} contains all the references used to make this document.
			\end{itemize}
	%end of first chapter

	\chapter{Architectural design}
		\section{Overview:	high-level	components	and	their	interaction}
	The application is built following the principles of the three-tier architecture: the three logic layers of presentation, 				application and data access rely on three corresponding hardware layers. This architecture is prefered to one-tier and 			two-tier architectures due to some important characteristics, some of which are:
	\begin{itemize}
	\item \emph{Flexibility:} each tier can be manged or scaled independently at any time, without affecting the others;
	\item \emph{Scalability:} following a scale-out approach, performances can be improved through node replication, without affecting the other tiers.
	Load balancing systems distribute the working load among the nodes;
	\item \emph{Mantainability:} because each tier is independent from the others, updates or changes can be released
	without affecting the whole system;
	\item \emph{Availbility:} with this architecture, it is less likely to have failures that compromise the whole application.
	Load balancing and node replication minimize the performance loss when a failure occures.
	\end{itemize}
	A general view of the system architecture is provided in the following picture:
	\begin{figure}[H]
			\includegraphics[scale = 0.6, center]{sysarch}
			\caption{System architecture}
	\end{figure}
	Users and authorities are provided with mobile devices and access the service through
	the SafeStreets mobile app. The mobile app communicates with the application layer, which
	is made by one or more application servers, linked to the database servers. The scale-out approach allows to adjust the number of hardware resources at any time. For what concerns the data access layer, database servers contain sensitive information, such as password hashes, license plate numbers, identification numbers and so on, so it is important to protect all the back-end of the application. In order to do this, the application and data access levels are protected by a firewall that performs traffic control at the level of the single packet, creating a DMZ in which the communication is safe. Another solution to reduce the computational load, as well as the messages, is the use of caches in the presentation tier: the mobile app stores on the mobile device memory part of the user's data, such as the sent reports and the results of reports evaluation, in order to make them available even when the users (or the authorities) have no access to Internet. This avoids many repeated requests for the same data, with heavy impact on the application and data acces layers' performance.
The system also includes a recommender system: exploiting data mining techniques, such as association rules, it can suggest to the authorities of one municipality possible interventions to improve security on the streets.

		\section{Component view}

	\begin{figure}[H]
				\includegraphics[scale = 0.4, center]{ComponentDiagramMaps}
				\caption{Component diagram - Google Maps}
	\end{figure}

	\begin{figure}[H]
				\includegraphics[scale = 0.5, center]{ComponentDiagramResponse}
				\caption{Component diagram - Response}
	\end{figure}

	\begin{figure}[H]
				\includegraphics[scale = 0.4, center]{ComponentDiagramDBMS}
				\caption{Component diagram - DBMS}
	\end{figure}

		\section{Deployment view}
		\section{Runtime view}
			In this section will be presented the sequence diagrams of the various functionality, is up to the application
			controlling and guaranteeing that each user can access only to the right functionality.
			\subsection{Making report}
				\begin{figure}[H]
						\includegraphics[width = 1.5\textwidth, center]{Report}
						\caption{How the report works}
						\label{fig: diagrams}
				\end{figure}
				This sequence diagrams explain the process through which a user can report a traffic violation.\\
				Once he has opened the application and logged in/signed up he can chose the ``Report violation" option,
				when he does that the application send the request to a router that forward the request to the right
				component (in this case the ``Report Manager").\\
				The first information the app request to the manager is to retrieve the user position, the request is forwarded
				to the Report manager and then to the Position manager (all request are centralized to the report manager).
				Then the user has to fill the form to report the traffic violations with the violation type and a photo of the
				violation and a photo of the plate. The request cannot be sent until all the form is completed.\\
				Is up to the application to verify that in the plate photo there is actually a plate. %How about that?
				Once the form has been sent the manager take care of the rest. First thing first the manager has to convert
				the photo of the plate into a String, so it send the plate's photo to the OCR manager, in this way using some
				photo manipulation techniques the system is able to obtain a String with the license plate.\\
				Once obtained that the report manager use a query to look up the database trying to find if there is already a
				pending (or resolved) report involving that car, in this way a car won't be reported twice for the same
				violations. If the vehicle has been already reported the application will display a message like ``I'm sorry but
				this vehicle has been already reported", to notify the user that the request failed.\\
				If it's not already reported the report is stored into the database, and a notification is sent to the authorities
				(using the notification manager).
			\subsection{Visualize Maps}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{Maps}
						\caption{How map visualization works}
						\label{fig: diagrams}
				\end{figure}

				This sequence diagrams explain the process through which a user can visualize the map to indentify which
				streets have the highest number of violations.\\
				Once he has opened the application and logged in/signed up he can chose the ``Visualize map" option,
				when he does that the application send the request to a router that forward the request to the right
				component (in this case the ``Maps Manager").\\
				The manager take care of everything, it obtain the user position in order to load the correct map from google
				maps, then it contact the db to retrieve information about the streets in that map to apply the correct colors
				and in the end it sends all to the application.
			\subsection{Visualize reports' history}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{history}
						\caption{How reports' history works}
						\label{fig: diagrams}
				\end{figure}
				This sequence diagrams explain the process through which a user can visualize the history of his previous
				reports.\\
				Once he has opened the application and logged in/signed up he can chose the ``My reports" option,
				when he does that the application send the request to a router that forward the request to the right
				component (in this case the ``Chronology Manager").\\
				The manager simply obtains all the previous reports by querying the db, if there aren't reports the manager
				will send a message to the app and will be displayed something like ``I am sorry, it seems that you didn't any
				report up to now".
				The user will see date\&time of each report, the status (pending, approved or rejected), the street and the
				type of violation.\\
				The plate won't be displayed to protect the privacy of the other citizens.
			\subsection{Evaluate report}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{Evaluate}
						\caption{How reports are evaluated}
						\label{fig: diagrams}
				\end{figure}
				This sequence diagrams explain the process through which an authorities can evaluate pending reports.\\
				Once he has opened the application and logged in/signed up he can chose the ``Evaluate" option,
				when he does that the application send the request to a router that forward the request to the right
				component (in this case the ``Evaluation Manager").\\
				The manager retrieve from the db all the unsolved reports and send them to the application module, each
				time that an authority resolve a report the manager update the db and, using the notification manager, send
				a notification to the user who made it to notify him the updated status.
			\subsection{Asking for recommendation}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{recommendation}
						\caption{How reports are evaluated}
						\label{fig: diagrams}
				\end{figure}
				This sequence diagrams explain the process through which an authorities can receive suggestion to improve
				the safety on the streets.\\
				Once he has opened the application and logged in/signed up he can chose the ``Recommend" option,
				when he does that the application send the request to a router that forward the request to the right
				component (in this case the ``Recommendation Manager").\\
				To receive recommendation on how to improve the safety on the streets the manager will use a recommender
				system based on content base approach based on item content matrix. To receive suggestion the manager
				will consult the recommender system and obtain the best possible solution, then it will be forwarded to the
				application.
		\section{Component interfaces}
			\subsection{Overall summary}
				In this section will be analyzed the interfaces necessary to each function, explaining the purpose of the main
				functions.
			\subsection{Main page}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{mainInterface}
						\label{fig: interfaces}
				\end{figure}
				\newpage In the figure above is represented the interface to manage the main page of the application.
				It is important to underline that it is the task of the application to ensure that each user can access the
				functions dedicated to him and not to others (for example a citizen can't see the evaluate option).
				%Is also up
				%to the system to check the validity of the created reports.
				%Here a quick description of the functions illustrated above:
					\begin{itemize}
						\item \textbf{App}
						\begin{itemize}
							\item \textbf{logIn} This method obtain the information from the ``Username" and the
								``Password" fields, and then call the logInManager
							\item \textbf{signUP} This method display the sign up form, then it obtain all the data
								from the fields and it controls their validity, then to complete the procedure and
								save the user in the db it calls the method ``sign up" from  ``sign up manager"
							\item \textbf{makeReport} This method display the form to report traffic violations and
								it starts the procedure, it will call all the methods of ``reportManager"
								(will be explained in detail to follow). 
							\item \textbf{evaluate} This method display the screen to evaluate traffic violations and
								it starts the procedure, it will call all the methods of ``evaluateManager"
								(will be explained in detail to follow).
							\item \textbf{history} This method display the history of the user's reported traffic
								violations and it starts the procedure, it will call all the methods of
								``historyManager" (will be explained in detail to follow).
							\item \textbf{map} This method display the map with the streets colored in function of the
								traffic violations' number.
							\item \textbf{recommendation} This method will give a suggestion on how to improve the
								safety on a particular street, the methods involved will be explained in detail to
								follow in the  ``recommendationManager".
						\end{itemize}
						\item \textbf{signUpManager}
						\begin{itemize}
							\item \textbf{signUp} This method will communicate in a safe way to the DB using an
								asymmetric key, it will memorize into the DB the Username and the hash of the
								password.
						\end{itemize}
						\item \textbf{logInManager}
						\begin{itemize}
							\item \textbf{logIn} This method will communicate in a safe way to the DB using
								symmetric encryption (established at the begging of the communication using
								asymmetric encryption), it will obtain the password's hash from the DB and it will
								confront it to the hash of the one the user inserted.
						\end{itemize}
					\end{itemize}
			\subsection{Report}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{reportInterface}
						%\caption{How reports are evaluated}
						\label{fig: interfaces}
				\end{figure}
				\begin{itemize}
					\item \textbf{reportManager}
					\begin{itemize}
						\item \textbf{sendReport} This method take the created reports and save it onto the DB adding
						the status (pending), and the username who created it.
						\item \textbf{userPosition} This method contact the position manager to retrieve the user
						position and send it to the client to include it in the report.
						\item \textbf{sendPlateForOCR} This method is called by the client, is used to translate the
						plate's photo into a String to include it into the DB and facilitate further operation of query
						\item \textbf{updateDb} This is the method that take care of every communication with the DB.
						\item \textbf{sendNotification} This method is used to notify the authorities of new reports.
					\end{itemize}
					\item \textbf{ocrManager}
					\begin{itemize}
						\item \textbf{translate} This is the method that using OCR techniques obtain the license plate
						from the photo.
					\end{itemize}
					\newpage \item \textbf{notificationManager}
					\begin{itemize}
						\item \textbf{sendNotification}  This method is up to contact the users required (both citizens
						and authorities) to notify them new reports (or updated status of previous ones).
					\end{itemize}
					\item \textbf{positionManager}
					\begin{itemize}
						\item \textbf{userPosition} This method is up to retrieve the user position using some techniques
						(not only using the GPS system but also using mobile data or wi-fi)
					\end{itemize}
					\item \textbf{gpsManager}
					\begin{itemize}
						\item \textbf{retreivePosition} This method is specific to retrieve the user position using only the
							GPS system.
					\end{itemize}
				\end{itemize}
			\subsection{History}
				\begin{figure}[H]
						\includegraphics[center]{historyInterface}
						%\caption{How reports are evaluated}
						\label{fig: interfaces}
				\end{figure}
				\begin{itemize}
					\item \textbf{getHistory} This method has to communicate with the application, receiving requests and
						sending back the data.
					\item \textbf{retreiveData} This method is specific to contact and query the DB to obtain the history of
						user's reports. 
				\end{itemize}
			\subsection{Map}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{mapInterface}
						%\caption{How reports are evaluated}
						\label{fig: interfaces}
				\end{figure}
				\begin{itemize}
						\item \textbf{mapManager}
						\begin{itemize}
							\item \textbf{visualizeMap} The method retrieve the data about reports and the streets
								and then combine it assigning each street the right color. 
							\item \textbf{obtainMap} Is called by visualizeMap and contact the gpsManager to
								retrieve the user position and then google Map to obtain the map around him.
							\item \textbf{obtainData} Is called by visualizeMap and this method has to contact the DB
								and it has to obtain the number of reports in each street visualized on the map in
								order to make able visualizeMap to coloring it correctly.
						\end{itemize}
						\item \textbf{gpsManager}
						\begin{itemize}
							\item \textbf{retreivePosition} Same as said above (in report).
						\end{itemize}
				\end{itemize}
			\subsection{Evaluate}
				\begin{figure}[H]
						\includegraphics[width = \textwidth, center]{evaluateInterface}
						%\caption{How reports are evaluated}
						\label{fig: interfaces}
				\end{figure}
				\begin{itemize}
						\item \textbf{evaluateManager}
						\begin{itemize}
							\item \textbf{evaluate:} Communicate with the client sending the pending reports and
								receiving all updated reports.
							\item \textbf{getReports:} This method is called by evaluate and obtain all pending
								reports in the area under the jurisdiction of the authority who made the request.
							\item \textbf{updateDB:} This method is called by evaluate and updates the DB with the
								new status of the evaluated reports
							\item \textbf{sendNotification:} allert the user which report has been evaluated
						\end{itemize}
						\item \textbf{notificationManager}
						\begin{itemize}
							\item \textbf{sendNotification:} as said above
						\end{itemize}
				\end{itemize}
			\subsection{Suggestion}
				\begin{figure}[H]
						\includegraphics [center]{recommendationInterface}
						%\caption{How reports are evaluated}
						\label{fig: interfaces}
				\end{figure}
				\begin{itemize}
					\item \textbf{getRecommendation} This method receive the request and, with the matrix already
						compiled it take the 3 most similar recommendation made by the system and forward them to the
						authority.
					\item \textbf{computeSimilarityMatrix} This method is used each time some data are added, it compute
					the similarity matrix between the most frequent problem (each problem is divided in small aspect and
					each of them is an attribute) and a ICM where each item is a possible solution (the attributes are some
					aspect of the problems that each solution can resolve)
				\end{itemize}
		\section{Selected architectural styles and patterns}
		\section{Other design decisions}
	%end of second chapter

	\chapter{User interfaces design}
	In chapter 3 of the RASD document some screenshots from the user interface were shown. This chapter describes the navigation in the user interface, both for the users and the authorities. The following UX diagrams refer to the mockups shown in the RASD, which are only the most relevant of the following.
	\section{User}
		\begin{figure}[H]
				\includegraphics[scale = 0.65, center]{userux}
				\caption{UX diagram - user}
		\end{figure}
	\section{Authority}
		\begin{figure}[H]
				\includegraphics[scale = 0.6, center]{authorityux}
				\caption{UX diagram - authority}
		\end{figure}
	%end of third chapter

	\chapter{Requirements Traceability}
	%end of fourth chapter

	\chapter{Implementation, Integration and Test plan}
	%end of fiveth chapter

	\chapter{Effort Spent}
		\begin{table}[H]
		\centering
		\begin{tabular}{|c|c|c|}
			\hline
			Chapter & Frangi (hours) & Fucci (hours)\\
			\hline
			\hline
			Chapter 1 & ? & ?\\
			\hline
			Chapter 2 & ? & ?\\
			\hline
			Chapter 3 & ? & ?\\
			\hline
			Chapter 4 & ? & ?\\
			\hline
			Chapter 5 & ? & ?\\
			\hline
			Total hours: & ? & ?\\
			\hline
		\end{tabular}
		\label{tab: }
	\end{table}
	%end of sixth chapter
	\chapter{References}
	%end of seventh chapter
\end{document}
